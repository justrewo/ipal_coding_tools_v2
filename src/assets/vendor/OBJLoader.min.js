THREE.OBJLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.materials=null;this.regexp={vertex_pattern:/^v\s+([\d\.\+\-eE]+)\s+([\d\.\+\-eE]+)\s+([\d\.\+\-eE]+)/,normal_pattern:/^vn\s+([\d\.\+\-eE]+)\s+([\d\.\+\-eE]+)\s+([\d\.\+\-eE]+)/,uv_pattern:/^vt\s+([\d\.\+\-eE]+)\s+([\d\.\+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,r,a){var i=this;var s=new THREE.FileLoader(i.manager);s.setPath(this.path);s.load(e,function(e){t(i.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===false){this.object.name=e;this.object.fromDeclaration=t!==false;return}var r=this.object&&typeof this.object.currentMaterial==="function"?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}this.object={name:e||"",fromDeclaration:t!==false,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:true,startMaterial:function(e,t){var r=this._finalize(false);if(r&&(r.inherited||r.groupCount<=0)){this.materials.splice(r.index,1)}var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:r!==undefined?r.smooth:this.smooth,groupStart:r!==undefined?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function(e){var t={index:typeof e==="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};t.clone=this.clone.bind(t);return t}};this.materials.push(a);return a},currentMaterial:function(){if(this.materials.length>0){return this.materials[this.materials.length-1]}return undefined},_finalize:function(e){var t=this.currentMaterial();if(t&&t.groupEnd===-1){t.groupEnd=this.geometry.vertices.length/3;t.groupCount=t.groupEnd-t.groupStart;t.inherited=false}if(e&&this.materials.length>1){for(var r=this.materials.length-1;r>=0;r--){if(this.materials[r].groupCount<=0){this.materials.splice(r,1)}}}if(e&&this.materials.length===0){this.materials.push({name:"",smooth:this.smooth})}return t}};if(r&&r.name&&typeof r.clone==="function"){var a=r.clone(0);a.inherited=true;this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}},parseVertexIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseNormalIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseUVIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/2)*2},addVertex:function(e,t,r){var a=this.vertices;var i=this.object.geometry.vertices;i.push(a[e+0]);i.push(a[e+1]);i.push(a[e+2]);i.push(a[t+0]);i.push(a[t+1]);i.push(a[t+2]);i.push(a[r+0]);i.push(a[r+1]);i.push(a[r+2])},addVertexLine:function(e){var t=this.vertices;var r=this.object.geometry.vertices;r.push(t[e+0]);r.push(t[e+1]);r.push(t[e+2])},addNormal:function(e,t,r){var a=this.normals;var i=this.object.geometry.normals;i.push(a[e+0]);i.push(a[e+1]);i.push(a[e+2]);i.push(a[t+0]);i.push(a[t+1]);i.push(a[t+2]);i.push(a[r+0]);i.push(a[r+1]);i.push(a[r+2])},addUV:function(e,t,r){var a=this.uvs;var i=this.object.geometry.uvs;i.push(a[e+0]);i.push(a[e+1]);i.push(a[t+0]);i.push(a[t+1]);i.push(a[r+0]);i.push(a[r+1])},addUVLine:function(e){var t=this.uvs;var r=this.object.geometry.uvs;r.push(t[e+0]);r.push(t[e+1])},addFace:function(e,t,r,a,i,s,n,o,h,l,u,d){var f=this.vertices.length;var c=this.parseVertexIndex(e,f);var p=this.parseVertexIndex(t,f);var m=this.parseVertexIndex(r,f);var v;if(a===undefined){this.addVertex(c,p,m)}else{v=this.parseVertexIndex(a,f);this.addVertex(c,p,v);this.addVertex(p,m,v)}if(i!==undefined){var g=this.uvs.length;c=this.parseUVIndex(i,g);p=this.parseUVIndex(s,g);m=this.parseUVIndex(n,g);if(a===undefined){this.addUV(c,p,m)}else{v=this.parseUVIndex(o,g);this.addUV(c,p,v);this.addUV(p,m,v)}}if(h!==undefined){var x=this.normals.length;c=this.parseNormalIndex(h,x);p=h===l?c:this.parseNormalIndex(l,x);m=h===u?c:this.parseNormalIndex(u,x);if(a===undefined){this.addNormal(c,p,m)}else{v=this.parseNormalIndex(d,x);this.addNormal(c,p,v);this.addNormal(p,m,v)}}},addLineGeometry:function(e,t){this.object.geometry.type="Line";var r=this.vertices.length;var a=this.uvs.length;for(var i=0,s=e.length;i<s;i++){this.addVertexLine(this.parseVertexIndex(e[i],r))}for(var n=0,s=t.length;n<s;n++){this.addUVLine(this.parseUVIndex(t[n],a))}}};e.startObject("",false);return e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();if(e.indexOf("\r\n")!==-1){e=e.replace(/\r\n/g,"\n")}if(e.indexOf("\\\n")!==-1){e=e.replace(/\\\n/g,"")}var r=e.split("\n");var a="",i="",s="";var n=0;var o=[];var h=typeof"".trimLeft==="function";for(var l=0,u=r.length;l<u;l++){a=r[l];a=h?a.trimLeft():a.trim();n=a.length;if(n===0)continue;i=a.charAt(0);if(i==="#")continue;if(i==="v"){s=a.charAt(1);if(s===" "&&(o=this.regexp.vertex_pattern.exec(a))!==null){t.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}else if(s==="n"&&(o=this.regexp.normal_pattern.exec(a))!==null){t.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]))}else if(s==="t"&&(o=this.regexp.uv_pattern.exec(a))!==null){t.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else{throw new Error("Unexpected vertex/normal/uv line: '"+a+"'")}}else if(i==="f"){if((o=this.regexp.face_vertex_uv_normal.exec(a))!==null){t.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12])}else if((o=this.regexp.face_vertex_uv.exec(a))!==null){t.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8])}else if((o=this.regexp.face_vertex_normal.exec(a))!==null){t.addFace(o[1],o[3],o[5],o[7],undefined,undefined,undefined,undefined,o[2],o[4],o[6],o[8])}else if((o=this.regexp.face_vertex.exec(a))!==null){t.addFace(o[1],o[2],o[3],o[4])}else{throw new Error("Unexpected face line: '"+a+"'")}}else if(i==="l"){var d=a.substring(1).trim().split(" ");var f=[],c=[];if(a.indexOf("/")===-1){f=d}else{for(var p=0,m=d.length;p<m;p++){var v=d[p].split("/");if(v[0]!=="")f.push(v[0]);if(v[1]!=="")c.push(v[1])}}t.addLineGeometry(f,c)}else if((o=this.regexp.object_pattern.exec(a))!==null){var g=(" "+o[0].substr(1).trim()).substr(1);t.startObject(g)}else if(this.regexp.material_use_pattern.test(a)){t.object.startMaterial(a.substring(7).trim(),t.materialLibraries)}else if(this.regexp.material_library_pattern.test(a)){t.materialLibraries.push(a.substring(7).trim())}else if((o=this.regexp.smoothing_pattern.exec(a))!==null){var x=o[1].trim().toLowerCase();t.object.smooth=x!=="0"&&x!=="off";var b=t.object.currentMaterial();if(b){b.smooth=t.object.smooth}}else{if(a==="\0")continue;throw new Error("Unexpected line: '"+a+"'")}}t.finalize();var E=new THREE.Group;E.materialLibraries=[].concat(t.materialLibraries);for(var l=0,u=t.objects.length;l<u;l++){var _=t.objects[l];var j=_.geometry;var y=_.materials;var L=j.type==="Line";if(j.vertices.length===0)continue;var V=new THREE.BufferGeometry;V.addAttribute("position",new THREE.BufferAttribute(new Float32Array(j.vertices),3));if(j.normals.length>0){V.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(j.normals),3))}else{V.computeVertexNormals()}if(j.uvs.length>0){V.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(j.uvs),2))}var w=[];for(var H=0,I=y.length;H<I;H++){var R=y[H];var b=undefined;if(this.materials!==null){b=this.materials.create(R.name);if(L&&b&&!(b instanceof THREE.LineBasicMaterial)){var T=new THREE.LineBasicMaterial;T.copy(b);b=T}}if(!b){b=!L?new THREE.MeshPhongMaterial:new THREE.LineBasicMaterial;b.name=R.name}b.shading=R.smooth?THREE.SmoothShading:THREE.FlatShading;w.push(b)}var F;if(w.length>1){for(var H=0,I=y.length;H<I;H++){var R=y[H];V.addGroup(R.groupStart,R.groupCount,H)}F=!L?new THREE.Mesh(V,w):new THREE.LineSegments(V,w)}else{F=!L?new THREE.Mesh(V,w[0]):new THREE.LineSegments(V,w[0])}F.name=_.name;E.add(F)}console.timeEnd("OBJLoader");return E}};