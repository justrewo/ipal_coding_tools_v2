THREE.SVGObject=function(e){THREE.Object3D.call(this);this.node=e};THREE.SVGObject.prototype=Object.create(THREE.Object3D.prototype);THREE.SVGObject.prototype.constructor=THREE.SVGObject;THREE.SVGRenderer=function(){console.log("THREE.SVGRenderer",THREE.REVISION);var e=this,i,t,o,n=new THREE.Projector,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),s,a,c,l,f,E,p,d,u=new THREE.Box2,h=new THREE.Box2,R=new THREE.Color,S=new THREE.Color,m=new THREE.Color,v=new THREE.Color,y=new THREE.Color,T=new THREE.Color,b=1,x=new THREE.Vector3,H=new THREE.Vector3,g=new THREE.Vector3,w=new THREE.Matrix3,M=new THREE.Matrix4,C=new THREE.Matrix4,z=[],j,L=0,V,k,P=1,G=null;this.domElement=r;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.setQuality=function(e){switch(e){case"high":P=1;break;case"low":P=0;break}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setClearColor=function(e,i){T.set(e);b=i!==undefined?i:1};this.setPixelRatio=function(){};this.setSize=function(e,i){s=e;a=i;c=s/2;l=a/2;r.setAttribute("viewBox",-c+" "+-l+" "+s+" "+a);r.setAttribute("width",s);r.setAttribute("height",a);u.min.set(-c,-l);u.max.set(c,l)};this.setPrecision=function(e){G=e};function B(){L=0;while(r.childNodes.length>0){r.removeChild(r.childNodes[0])}}function O(e,i){var t=Math.floor(e.r*255)+","+Math.floor(e.g*255)+","+Math.floor(e.b*255);if(i===undefined||i===1)return"rgb("+t+")";return"rgba("+t+","+i+")"}function F(e){return G!==null?e.toFixed(G):e}this.clear=function(){B();r.style.backgroundColor=O(T,b)};this.render=function(s,a){if(a instanceof THREE.Camera===false){console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.");return}var d=s.background;if(d&&d.isColor){B();r.style.backgroundColor=O(d)}else if(this.autoClear===true){this.clear()}e.info.render.vertices=0;e.info.render.faces=0;M.copy(a.matrixWorldInverse);C.multiplyMatrices(a.projectionMatrix,M);i=n.projectScene(s,a,this.sortObjects,this.sortElements);t=i.elements;o=i.lights;w.getNormalMatrix(a.matrixWorldInverse);A(o);V="";k="";for(var R=0,S=t.length;R<S;R++){var m=t[R];var v=m.material;if(v===undefined||v.opacity===0)continue;h.makeEmpty();if(m instanceof THREE.RenderableSprite){f=m;f.x*=c;f.y*=-l;N(f,m,v)}else if(m instanceof THREE.RenderableLine){f=m.v1;E=m.v2;f.positionScreen.x*=c;f.positionScreen.y*=-l;E.positionScreen.x*=c;E.positionScreen.y*=-l;h.setFromPoints([f.positionScreen,E.positionScreen]);if(u.intersectsBox(h)===true){D(f,E,m,v)}}else if(m instanceof THREE.RenderableFace){f=m.v1;E=m.v2;p=m.v3;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;if(E.positionScreen.z<-1||E.positionScreen.z>1)continue;if(p.positionScreen.z<-1||p.positionScreen.z>1)continue;f.positionScreen.x*=c;f.positionScreen.y*=-l;E.positionScreen.x*=c;E.positionScreen.y*=-l;p.positionScreen.x*=c;p.positionScreen.y*=-l;h.setFromPoints([f.positionScreen,E.positionScreen,p.positionScreen]);if(u.intersectsBox(h)===true){I(f,E,p,m,v)}}}q();s.traverseVisible(function(e){if(e instanceof THREE.SVGObject){x.setFromMatrixPosition(e.matrixWorld);x.applyMatrix4(C);var i=x.x*c;var t=-x.y*l;var o=e.node;o.setAttribute("transform","translate("+i+","+t+")");r.appendChild(o)}})};function A(e){m.setRGB(0,0,0);v.setRGB(0,0,0);y.setRGB(0,0,0);for(var i=0,t=e.length;i<t;i++){var o=e[i];var n=o.color;if(o instanceof THREE.AmbientLight){m.r+=n.r;m.g+=n.g;m.b+=n.b}else if(o instanceof THREE.DirectionalLight){v.r+=n.r;v.g+=n.g;v.b+=n.b}else if(o instanceof THREE.PointLight){y.r+=n.r;y.g+=n.g;y.b+=n.b}}}function W(e,i,t,o){for(var n=0,r=e.length;n<r;n++){var s=e[n];var a=s.color;if(s instanceof THREE.DirectionalLight){var c=x.setFromMatrixPosition(s.matrixWorld).normalize();var l=t.dot(c);if(l<=0)continue;l*=s.intensity;o.r+=a.r*l;o.g+=a.g*l;o.b+=a.b*l}else if(s instanceof THREE.PointLight){var c=x.setFromMatrixPosition(s.matrixWorld);var l=t.dot(x.subVectors(c,i).normalize());if(l<=0)continue;l*=s.distance==0?1:1-Math.min(i.distanceTo(c)/s.distance,1);if(l==0)continue;l*=s.intensity;o.r+=a.r*l;o.g+=a.g*l;o.b+=a.b*l}}}function N(e,i,t){var o=i.scale.x*c;var n=i.scale.y*l;if(t.isPointsMaterial){o*=t.size;n*=t.size}var r="M"+F(e.x-o*.5)+","+F(e.y-n*.5)+"h"+F(o)+"v"+F(n)+"h"+F(-o)+"z";var s="";if(t.isSpriteMaterial||t.isPointsMaterial){s="fill:"+O(t.color,t.opacity)}Q(s,r)}function D(e,i,t,o){var n="M"+F(e.positionScreen.x)+","+F(e.positionScreen.y)+"L"+F(i.positionScreen.x)+","+F(i.positionScreen.y);if(o.isLineBasicMaterial){var r="fill:none;stroke:"+O(o.color,o.opacity)+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;if(o.isLineDashedMaterial){r=r+";stroke-dasharray:"+o.dashSize+","+o.gapSize}Q(r,n)}}function I(i,t,n,r,s){e.info.render.vertices+=3;e.info.render.faces++;var a="M"+F(i.positionScreen.x)+","+F(i.positionScreen.y)+"L"+F(t.positionScreen.x)+","+F(t.positionScreen.y)+"L"+F(n.positionScreen.x)+","+F(n.positionScreen.y)+"z";var c="";if(s instanceof THREE.MeshBasicMaterial){R.copy(s.color);if(s.vertexColors===THREE.FaceColors){R.multiply(r.color)}}else if(s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial){S.copy(s.color);if(s.vertexColors===THREE.FaceColors){S.multiply(r.color)}R.copy(m);H.copy(i.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3);W(o,H,r.normalModel,R);R.multiply(S).add(s.emissive)}else if(s instanceof THREE.MeshNormalMaterial){g.copy(r.normalModel).applyMatrix3(w);R.setRGB(g.x,g.y,g.z).multiplyScalar(.5).addScalar(.5)}if(s.wireframe){c="fill:none;stroke:"+O(R,s.opacity)+";stroke-width:"+s.wireframeLinewidth+";stroke-linecap:"+s.wireframeLinecap+";stroke-linejoin:"+s.wireframeLinejoin}else{c="fill:"+O(R,s.opacity)}Q(c,a)}function Q(e,i){if(k===e){V+=i}else{q();k=e;V=i}}function q(){if(V){j=J(L++);j.setAttribute("d",V);j.setAttribute("style",k);r.appendChild(j)}V="";k=""}function J(e){if(z[e]==null){z[e]=document.createElementNS("http://www.w3.org/2000/svg","path");if(P==0){z[e].setAttribute("shape-rendering","crispEdges")}return z[e]}return z[e]}};